{% block content %}
<div class="box_c"><div class="box_t">Job List:</div><div class="st_boxes">
	<table class="table"><tr><td>ID</td><td>NAME</td><td>Path</td><td>Interval</td><td>Last Run</td><td>Global Hold</td><td>Status</td><td>Action</td></tr>
    {% for item in jItems %}
	<tr>
		<td>{{ item.id }}</td>
		<td>{{ item.name }}</td>
		<td>{{ item.path }}</td>
		<td>{{ item.interval }}</td>
		<td>{{ item.last_run|date("m/d/Y H:i:s") }}</td>
		{% if item.global_hold == 0 %}
			<td>Ready</td>
		{% else %}
			<td>Held</td>
		{% endif %}

		{% if item.status_int == 0 %}
			<td>In Queue</td>
		{% else %}
			<td>Ready</td>
		{% endif %}
		<td><a class="btn btn-default btn-xs" alt="Add to Queue for one time run" href="#" role="button" onclick="insertQ('{{ item.id }}', '{{ item.path|escape('js') }}')">Add to Queue</a> 
		<a class="btn btn-danger btn-xs" alt="Remove Job" href="#" role="button" onclick="removeJob('{{ item.id }}')"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></a> 
		<a class="btn btn-primary btn-xs" alt="Edit" href="#" role="button"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a> 
		{% if item.global_hold == 1 %}
			<a class="btn btn-default btn-xs" alt="Run job." href="#" role="button" onclick="holdJobGlobal('{{ item.id }}', 0)">Release</a>
		{% else %}
			<a class="btn btn-danger btn-xs" alt="Put job on hold." href="#" role="button" onclick="holdJobGlobal('{{ item.id }}', 1)">Hold</a>
		{% endif %}
		</td>
	</tr>		
    {% else %}  
        <p style='color: red'>There are currently no jobs configured.</p>
    {% endfor %}
	</table></div></div>
	
	<script>
		function insertQ ($jobid, $path) {
			if($jobid === ""|| $path === ""){
				alert("data incorrect");
			}else{
				var hold = 1;
				$.post("api/postQueue",
					{ jobid: $jobid, path: $path, hold: hold },
					function(data, status){
						var $container = $("#queue");
						$container.load("/boxes/queue").fadeIn("slow");
				});
			}
		}
		
		function removeJob (id) {
			//alert("removing: " + id);
			if(confirm('Are you sure you want to delete this Job? This will completely remove the job from the system!')){
				$.post("api/deleteJobGlobal",
					{ id: id },
					function(data, status){
						var $container = $("#jobs");
						$container.load("/boxes/jobs").fadeIn("slow");
					});
			}else{
				alert('Item not deleted!');
			}
		}
		
		function holdJobGlobal ($id, $flag) {
			if($id === ""){
				alert("data incorrect");
			}else{
				$.post("api/holdJobGlobal",
					{ id: $id, hflag: $flag },
					function(data, status){
						//reload queue status box on success
						var $container2 = $("#queue");
						$container2.load("/boxes/queue").fadeIn("slow");
				});
			}
		}
	
	</script>
{% endblock %}